from datetime import date
from app import app
from app import transform_availability_list

stub_response = {
  "2019-08-27": {
    "2019-08-27T11:00:00-04:00": '372955',
    "2019-08-27T12:00:00-04:00": '372955',
    "2019-08-27T10:00:00-04:00": '372955',
    "2019-08-27T14:00:00-04:00": '372955',
    "2019-08-27T13:00:00-04:00": '372955',
    "2019-08-27T16:00:00-04:00": '372955'
  },
  "2019-08-24": {
    "2019-08-24T13:00:00-04:00": '397688',
    "2019-08-24T00:00:00-04:00": '424185',
    "2019-08-24T10:30:00-04:00": '319369',
    "2019-08-24T14:00:00-04:00": '397688',
    "2019-08-24T17:00:00-04:00": '397688',
    "2019-08-24T20:00:00-04:00": '319369',
    "2019-08-24T10:00:00-04:00": '397688',
    "2019-08-24T12:00:00-04:00": '397688',
    "2019-08-24T15:00:00-04:00": '397688',
    "2019-08-24T11:00:00-04:00": '319369',
    "2019-08-24T18:00:00-04:00": '397688',
    "2019-08-24T16:00:00-04:00": '397688'
  },
  "2019-08-25": {
    "2019-08-25T20:00:00-04:00": '319369',
    "2019-08-25T10:30:00-04:00": '319369',
    "2019-08-25T11:00:00-04:00": '319369'
  },
  "2019-08-22": {
    "2019-08-22T05:00:00-04:00": '419054',
    "2019-08-22T08:00:00-04:00": '419054',
    "2019-08-22T16:00:00-04:00": '399956',
    "2019-08-22T14:00:00-04:00": '419054',
    "2019-08-22T20:00:00-04:00": '399956',
    "2019-08-22T18:00:00-04:00": 419054,
    "2019-08-22T00:00:00-04:00": 399956,
    "2019-08-22T15:00:00-04:00": 499660,
    "2019-08-22T19:00:00-04:00": 419054,
    "2019-08-22T06:00:00-04:00": 419054,
    "2019-08-22T12:15:00-04:00": 399958,
    "2019-08-22T13:00:00-04:00": 419054,
    "2019-08-22T23:00:00-04:00": 399956,
    "2019-08-22T08:45:00-04:00": 424185,
    "2019-08-22T19:30:00-04:00": 541249,
    "2019-08-22T21:00:00-04:00": 399956,
    "2019-08-22T10:00:00-04:00": 424108,
    "2019-08-22T12:00:00-04:00": 419054,
    "2019-08-22T01:00:00-04:00": 399956,
    "2019-08-22T03:00:00-04:00": 419054,
    "2019-08-22T17:00:00-04:00": 419054,
    "2019-08-22T11:30:00-04:00": 419054,
    "2019-08-22T22:00:00-04:00": 399956,
    "2019-08-22T02:00:00-04:00": 399956,
    "2019-08-22T14:30:00-04:00": 540517,
    "2019-08-22T16:30:00-04:00": 419054,
    "2019-08-22T15:30:00-04:00": 397688,
    "2019-08-22T11:00:00-04:00": 335698,
    "2019-08-22T04:00:00-04:00": 419054,
    "2019-08-22T17:30:00-04:00": 417239,
    "2019-08-22T07:00:00-04:00": 419054,
    "2019-08-22T10:30:00-04:00": 417239,
    "2019-08-22T12:30:00-04:00": 417239,
    "2019-08-22T13:15:00-04:00": 399958,
    "2019-08-22T11:15:00-04:00": 399958,
    "2019-08-22T09:00:00-04:00": 424108
  },
  "2019-08-23": {
    "2019-08-23T18:15:00-04:00": 399958,
    "2019-08-23T01:00:00-04:00": 399956,
    "2019-08-23T14:00:00-04:00": 399958,
    "2019-08-23T20:00:00-04:00": 499660,
    "2019-08-23T17:00:00-04:00": 399958,
    "2019-08-23T22:00:00-04:00": 424185,
    "2019-08-23T19:00:00-04:00": 399958,
    "2019-08-23T15:00:00-04:00": 499660,
    "2019-08-23T18:30:00-04:00": 541249,
    "2019-08-23T18:00:00-04:00": 499459,
    "2019-08-23T06:00:00-04:00": 419054,
    "2019-08-23T10:15:00-04:00": 417239,
    "2019-08-23T04:00:00-04:00": 419054,
    "2019-08-23T08:00:00-04:00": 419054,
    "2019-08-23T10:00:00-04:00": 424108,
    "2019-08-23T16:30:00-04:00": 541249,
    "2019-08-23T11:45:00-04:00": 417239,
    "2019-08-23T21:00:00-04:00": 499459,
    "2019-08-23T16:45:00-04:00": 399958,
    "2019-08-23T05:00:00-04:00": 419054,
    "2019-08-23T13:30:00-04:00": 499660,
    "2019-08-23T09:00:00-04:00": 424108,
    "2019-08-23T16:00:00-04:00": 397688,
    "2019-08-23T11:15:00-04:00": 399958,
    "2019-08-23T03:00:00-04:00": 419054,
    "2019-08-23T10:30:00-04:00": 397688,
    "2019-08-23T08:45:00-04:00": 424185,
    "2019-08-23T00:00:00-04:00": 399956,
    "2019-08-23T17:30:00-04:00": 417239,
    "2019-08-23T15:30:00-04:00": 399958,
    "2019-08-23T02:00:00-04:00": 399956,
    "2019-08-23T11:00:00-04:00": 424108,
    "2019-08-23T11:30:00-04:00": 335698,
    "2019-08-23T23:00:00-04:00": 424185,
    "2019-08-23T07:00:00-04:00": 419054,
    "2019-08-23T13:00:00-04:00": 399958,
    "2019-08-23T14:30:00-04:00": 540517,
    "2019-08-23T06:30:00-04:00": 424108
  },
  "2019-08-21": {
    "2019-08-21T15:00:00-04:00": 399959,
    "2019-08-21T14:15:00-04:00": 399958,
    "2019-08-21T13:45:00-04:00": '419054',
    "2019-08-21T20:00:00-04:00": '399956',
    "2019-08-21T16:00:00-04:00": '399958',
    "2019-08-21T21:00:00-04:00": '399956',
    "2019-08-21T17:00:00-04:00": '419054',
    "2019-08-21T14:00:00-04:00": '419054',
    "2019-08-21T15:30:00-04:00": '399958',
    "2019-08-21T22:00:00-04:00": '399956',
    "2019-08-21T17:30:00-04:00": '417239',
    "2019-08-21T19:00:00-04:00": '419054',
    "2019-08-21T19:30:00-04:00": '541249',
    "2019-08-21T18:00:00-04:00": '419054',
    "2019-08-21T23:00:00-04:00": '399956',
    "2019-08-21T14:30:00-04:00": '499459',
    "2019-08-21T17:15:00-04:00": '399958',
    "2019-08-21T16:30:00-04:00": '419054'
  }
}

def test_today():
    with app.test_client() as cli:
        resp = cli.get('/today')
        assert resp.status_code == 200
        assert resp.json == {"today": "{}".format(date.today())}

def test_times_by_advisor_id_returns_times_ordered_by_advisor_id():
    with app.test_client() as cli:
        resp = cli.get('/times_by_advisor_id')
        assert '419054' in resp.json.keys()
        assert "2019-08-21T16:30:00-04:00" in resp.json['419054']

def test_today_with_no_existing_bookings_returns_correct_data():
    formatted_data = transform_availability_list(stub_response)
    with app.test_client() as cli:
        resp = cli.get('/times_by_advisor_id')
        assert resp.json == formatted_data

def test_booking_a_time_with_a_name_succeeds_if_available():
    with app.test_client() as cli:
        assert False

def test_booking_a_time_with_a_name_fails_if_unavailable():
    with app.test_client() as cli:
        assert False

def test_booking_a_time_without_a_name_fails():
    with app.test_client() as cli:
        assert False

def test_today_requests_data_from_api():
    with app.test_client() as cli:
        assert False